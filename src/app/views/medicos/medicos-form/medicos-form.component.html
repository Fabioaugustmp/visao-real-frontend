<div class="animated fadeIn">
  <c-row>
    <c-col xs="12">
      <c-card class="mb-4">
        <c-card-header class="d-flex justify-content-between align-items-center">
          <strong>{{ isEditMode ? 'Editar Médico' : 'Novo Médico' }}</strong>
          <span *ngIf="isEditMode" class="badge bg-info-subtle text-info-emphasis">
            <c-icon name="cilPencil" size="sm" class="me-1"></c-icon>
            Modo Edição
          </span>
        </c-card-header>
        <c-card-body>
          <form [formGroup]="medicoForm" (ngSubmit)="onSubmit()">

            <!-- Validation Alert -->
            <c-alert color="danger" *ngIf="getFormErrors().length > 0" [dismissible]="true" class="mb-4">
              <div class="d-flex align-items-start">
                <c-icon name="cilWarning" size="lg" class="me-2 flex-shrink-0"></c-icon>
                <div>
                  <strong>Erros de Validação</strong>
                  <ul class="mb-0 mt-2">
                    <li *ngFor="let error of getFormErrors()">{{ error }}</li>
                  </ul>
                </div>
              </div>
            </c-alert>

            <!-- Dados Pessoais -->
            <c-card class="mb-4 shadow-sm">
              <c-card-header class="bg-light-subtle">
                <c-icon name="cilUser" class="me-2"></c-icon>
                <strong>Dados Pessoais</strong>
              </c-card-header>
              <c-card-body>
                <c-row class="g-3">
                  <c-col md="12">
                    <label cLabel for="nome" class="form-label">
                      Nome Completo <span class="text-danger">*</span>
                    </label>
                    <input cFormControl id="nome" formControlName="nome" placeholder="Nome do médico"
                      [ngClass]="{'is-invalid': medicoForm.get('nome')?.invalid && (medicoForm.get('nome')?.dirty || medicoForm.get('nome')?.touched)}">
                    <div
                      *ngIf="medicoForm.get('nome')?.invalid && (medicoForm.get('nome')?.dirty || medicoForm.get('nome')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('nome')?.errors?.['required']">Nome é obrigatório</span>
                    </div>
                  </c-col>
                  <c-col md="6">
                    <label cLabel for="cpf" class="form-label">
                      CPF <span class="text-danger">*</span>
                    </label>
                    <input cFormControl id="cpf" formControlName="cpf" mask="000.000.000-00" placeholder="000.000.000-00"
                      [ngClass]="{'is-invalid': medicoForm.get('cpf')?.invalid && (medicoForm.get('cpf')?.dirty || medicoForm.get('cpf')?.touched)}">
                    <div
                      *ngIf="medicoForm.get('cpf')?.invalid && (medicoForm.get('cpf')?.dirty || medicoForm.get('cpf')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('cpf')?.errors?.['required']">CPF é obrigatório</span>
                    </div>
                  </c-col>
                  <c-col md="6">
                    <label cLabel for="dataNasc" class="form-label">
                      Data de Nascimento <span class="text-danger">*</span>
                    </label>
                    <input cFormControl id="dataNasc" formControlName="dataNasc" type="date"
                      [ngClass]="{'is-invalid': medicoForm.get('dataNasc')?.invalid && (medicoForm.get('dataNasc')?.dirty || medicoForm.get('dataNasc')?.touched)}">
                    <div
                      *ngIf="medicoForm.get('dataNasc')?.invalid && (medicoForm.get('dataNasc')?.dirty || medicoForm.get('dataNasc')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('dataNasc')?.errors?.['required']">Data de nascimento é
                        obrigatória</span>
                    </div>
                  </c-col>
                </c-row>
              </c-card-body>
            </c-card>

            <!-- Contato -->
            <c-card class="mb-4 shadow-sm">
              <c-card-header class="bg-light-subtle">
                <c-icon name="cilEnvelopeOpen" class="me-2"></c-icon>
                <strong>Contato</strong>
              </c-card-header>
              <c-card-body>
                <c-row class="g-3">
                  <c-col md="12">
                    <label cLabel for="email" class="form-label">
                      Email <span class="text-danger">*</span>
                    </label>
                    <input cFormControl id="email" formControlName="email" type="email" placeholder="email@exemplo.com"
                      [ngClass]="{'is-invalid': medicoForm.get('email')?.invalid && (medicoForm.get('email')?.dirty || medicoForm.get('email')?.touched)}">
                    <div
                      *ngIf="medicoForm.get('email')?.invalid && (medicoForm.get('email')?.dirty || medicoForm.get('email')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('email')?.errors?.['required']">Email é obrigatório</span>
                      <span *ngIf="medicoForm.get('email')?.errors?.['email']">Email inválido</span>
                    </div>
                  </c-col>
                </c-row>
              </c-card-body>
            </c-card>

            <!-- Dados Profissionais -->
            <c-card class="mb-4 shadow-sm">
              <c-card-header class="bg-light-subtle">
                <c-icon name="cilBriefcase" class="me-2"></c-icon>
                <strong>Dados Profissionais</strong>
              </c-card-header>
              <c-card-body>
                <c-row class="g-3">
                  <c-col md="6">
                    <label cLabel for="crm" class="form-label">
                      CRM <span class="text-danger">*</span>
                    </label>
                    <input cFormControl id="crm" formControlName="crm" placeholder="CRM do médico"
                      [ngClass]="{'is-invalid': medicoForm.get('crm')?.invalid && (medicoForm.get('crm')?.dirty || medicoForm.get('crm')?.touched)}">
                    <div
                      *ngIf="medicoForm.get('crm')?.invalid && (medicoForm.get('crm')?.dirty || medicoForm.get('crm')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('crm')?.errors?.['required']">CRM é obrigatório</span>
                    </div>
                  </c-col>
                  <c-col md="6">
                    <label cLabel for="taxaImposto" class="form-label">
                      Taxa de Imposto (%) <span class="text-danger">*</span>
                    </label>
                    <input cFormControl id="taxaImposto" formControlName="taxaImposto" type="number" step="0.01"
                      placeholder="0.00"
                      [ngClass]="{'is-invalid': medicoForm.get('taxaImposto')?.invalid && (medicoForm.get('taxaImposto')?.dirty || medicoForm.get('taxaImposto')?.touched)}">
                    <div
                      *ngIf="medicoForm.get('taxaImposto')?.invalid && (medicoForm.get('taxaImposto')?.dirty || medicoForm.get('taxaImposto')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('taxaImposto')?.errors?.['required']">Taxa de imposto é
                        obrigatória</span>
                    </div>
                  </c-col>
                </c-row>
              </c-card-body>
            </c-card>

            <!-- Sistema -->
            <c-card class="mb-4 shadow-sm">
              <c-card-header class="bg-light-subtle">
                <c-icon name="cilSettings" class="me-2"></c-icon>
                <strong>Configurações do Sistema</strong>
              </c-card-header>
              <c-card-body>
                <c-row class="g-3">
                  <c-col md="6">
                    <label cLabel for="empresa" class="form-label">
                      Empresa <span class="text-danger">*</span>
                    </label>
                    <select cSelect id="empresa" formControlName="empresa"
                      [ngClass]="{'is-invalid': medicoForm.get('empresa')?.invalid && (medicoForm.get('empresa')?.dirty || medicoForm.get('empresa')?.touched)}">
                      <option [ngValue]="null">Selecione uma empresa</option>
                      <option *ngFor="let empresa of empresas" [value]="empresa.id">{{ empresa.razaoSocial }}</option>
                    </select>
                    <div
                      *ngIf="medicoForm.get('empresa')?.invalid && (medicoForm.get('empresa')?.dirty || medicoForm.get('empresa')?.touched)"
                      class="invalid-feedback">
                      <span *ngIf="medicoForm.get('empresa')?.errors?.['required']">Empresa é obrigatória</span>
                    </div>
                  </c-col>
                  <c-col md="6">
                    <label cLabel for="usuario" class="form-label">
                      Usuário Vinculado <span class="text-danger">*</span>
                    </label>
                    <select cSelect id="usuario" formControlName="usuario"
                      [ngClass]="{'is-invalid': medicoForm.get('usuario')?.invalid && (medicoForm.get('usuario')?.dirty || medicoForm.get('usuario')?.touched)}">
                      <option [ngValue]="null">Selecione um usuário</option>
                      <option *ngFor="let usuario of usuarios" [value]="usuario.id">{{ usuario.nome }}</option>
                    </select>
                    <div *ngIf="medicoForm.get('usuario')?.invalid && (medicoForm.get('usuario')?.dirty || medicoForm.get('usuario')?.touched)" class="invalid-feedback">
                      <span *ngIf="medicoForm.get('usuario')?.errors?.['required']">Usuário é obrigatório</span>
                    </div>
                  </c-col>
                </c-row>
              </c-card-body>
            </c-card>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-end gap-2 pt-3 border-top">
              <button cButton color="secondary" variant="outline" [routerLink]="['/medicos']" type="button">
                <c-icon name="cilX" class="me-1"></c-icon>
                Cancelar
              </button>
              <button cButton color="primary" type="submit" [disabled]="medicoForm.invalid">
                <c-icon name="cilCheckCircle" class="me-1"></c-icon>
                {{ isEditMode ? 'Atualizar Médico' : 'Salvar Médico' }}
              </button>
            </div>

          </form>
        </c-card-body>
      </c-card>
    </c-col>
  </c-row>
</div>
