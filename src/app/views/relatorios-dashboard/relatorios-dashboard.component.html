<c-row>
  <!-- Filter Section -->
  <c-col xs="12">
    <c-card class="mb-4 filter-card">
      <c-card-header class="bg-gradient-primary text-white d-flex justify-content-between align-items-center"
        style="cursor: pointer;" (click)="toggleFilter()">
        <h5 class="mb-0">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-funnel me-2"
            viewBox="0 0 16 16">
            <path
              d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2h-11z" />
          </svg>
          Filtros de Pesquisa
        </h5>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-down"
          viewBox="0 0 16 16" [style.transform]="isFilterCollapsed ? 'rotate(0deg)' : 'rotate(180deg)'"
          style="transition: transform 0.3s ease;">
          <path fill-rule="evenodd"
            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
        </svg>
      </c-card-header>
      <c-card-body [hidden]="isFilterCollapsed">
        <form [formGroup]="filterForm" cForm>
          <c-row>
            <!-- Date Range -->
            <c-col md="3">
              <div class="mb-3">
                <label cLabel for="startDate" class="form-label">Data Início</label>
                <input cFormControl type="date" id="startDate" formControlName="startDate" class="form-control">
              </div>
            </c-col>
            <c-col md="3">
              <div class="mb-3">
                <label cLabel for="finishDate" class="form-label">Data Fim</label>
                <input cFormControl type="date" id="finishDate" formControlName="finishDate" class="form-control">
              </div>
            </c-col>

            <!-- Medico Dropdown (Admin Only) -->
            <c-col md="3" *ngIf="isAdmin">
              <div class="mb-3">
                <label cLabel for="medicoId" class="form-label">Médico</label>
                <select cFormSelect id="medicoId" formControlName="medicoId" class="form-select">
                  <option [value]="null">Todos os Médicos</option>
                  <option *ngFor="let medico of medicos" [value]="medico.id">
                    {{ medico.nome }} - {{ medico.crm }}
                  </option>
                </select>
              </div>
            </c-col>

            <!-- Year Selector -->
            <c-col md="3">
              <div class="mb-3">
                <label cLabel for="year" class="form-label">Ano</label>
                <select cFormSelect id="year" formControlName="year" class="form-select">
                  <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                </select>
              </div>
            </c-col>
          </c-row>

          <!-- Action Buttons -->
          <c-row>
            <c-col xs="12">
              <button cButton color="primary" (click)="onApplyFilters()" class="me-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-search me-1" viewBox="0 0 16 16">
                  <path
                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg>
                Aplicar Filtros
              </button>
              <button cButton color="secondary" variant="outline" (click)="onClearFilters()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                  class="bi bi-x-circle me-1" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                  <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                </svg>
                Limpar
              </button>
            </c-col>
          </c-row>
        </form>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<!-- KPI Cards Row -->
<c-row class="mb-4">

  <!-- Faturamento do Dia -->
  <c-col sm="6" lg="3">
    <c-card class="kpi-card bg-gradient-warning">
      <c-card-body class="pb-0 d-flex justify-content-between align-items-start">
        <div>
          <div class="text-white-50 small text-uppercase fw-semibold">Faturamento do Dia</div>
          <div class="fs-4 fw-bold mt-2">{{ faturamento?.faturamentoDia | currency:'BRL':'symbol':'1.2-2' }}
          </div>
        </div>
        <div class="text-white-50">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-calendar-day"
            viewBox="0 0 16 16">
            <path
              d="M4.684 11.523v-2.3h2.261v-.61H4.684V6.801h2.464v-.61H4v5.332h.684zm3.296 0h.676V8.98c0-.554.227-1.007.953-1.007.125 0 .258.004.329.015v-.613a1.806 1.806 0 0 0-.254-.02c-.582 0-.891.32-1.012.567h-.02v-.504H7.98v4.105zm2.805-5.093c0 .238.192.425.43.425a.428.428 0 1 0 0-.855.426.426 0 0 0-.43.43zm.094 5.093h.672V7.418h-.672v4.105z" />
            <path
              d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
          </svg>
        </div>
      </c-card-body>
      <c-card-footer class="bg-transparent border-0 pt-3">
        <small class="text-white-50">Período: Hoje</small>
      </c-card-footer>
    </c-card>
  </c-col>

  <!-- Faturamento da Semana -->
  <c-col sm="6" lg="3">
    <c-card class="kpi-card bg-gradient-danger">
      <c-card-body class="pb-0 d-flex justify-content-between align-items-start">
        <div>
          <div class="text-white-50 small text-uppercase fw-semibold">Faturamento da Semana</div>
          <div class="fs-4 fw-bold mt-2">{{ faturamento?.faturamentoSemana | currency:'BRL':'symbol':'1.2-2' }}</div>
        </div>
        <div class="text-white-50">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-calendar-week"
            viewBox="0 0 16 16">
            <path
              d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-5 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z" />
            <path
              d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
          </svg>
        </div>
      </c-card-body>
      <c-card-footer class="bg-transparent border-0 pt-3">
        <small class="text-white-50">Período: Últimos 7 dias</small>
      </c-card-footer>
    </c-card>
  </c-col>

  <!-- Faturamento do Mês -->
  <c-col sm="6" lg="3">
    <c-card class="kpi-card bg-gradient-primary">
      <c-card-body class="pb-0 d-flex justify-content-between align-items-start">
        <div>
          <div class="text-white-50 small text-uppercase fw-semibold">Faturamento do Mês</div>
          <div class="fs-4 fw-bold mt-2">{{ faturamento?.faturamentoMes | currency:'BRL':'symbol':'1.2-2' }}</div>
        </div>
        <div class="text-white-50">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor"
            class="bi bi-calendar-month" viewBox="0 0 16 16">
            <path
              d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10 3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm-4 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM2 14V5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1zm12-9H2V2a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v3z" />
          </svg>
        </div>
      </c-card-body>
      <c-card-footer class="bg-transparent border-0 pt-3">
        <small class="text-white-50">Período: Mês atual</small>
      </c-card-footer>
    </c-card>
  </c-col>

  <!-- Faturamento Acumulado Ano -->
  <c-col sm="6" lg="3">
    <c-card class="kpi-card bg-gradient-info">
      <c-card-body class="pb-0 d-flex justify-content-between align-items-start">
        <div>
          <div class="text-white-50 small text-uppercase fw-semibold">Acumulado Anual</div>
          <div class="fs-4 fw-bold mt-2">{{ faturamento?.faturamentoAnual | currency:'BRL':'symbol':'1.2-2' }}</div>
        </div>
        <div class="text-white-50">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor"
            class="bi bi-graph-up-arrow" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M0 0h1v15h15v1H0V0Zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5Z" />
          </svg>
        </div>
      </c-card-body>
      <c-card-footer class="bg-transparent border-0 pt-3">
        <small class="text-white-50">Período: Ano atual</small>
      </c-card-footer>
    </c-card>
  </c-col>
</c-row>

<!-- Summary Card -->
<c-row class="mb-4">
  <c-col xs="12">
    <c-card class="summary-card">
      <c-card-body>
        <c-row class="text-center">
          <c-col md="3" class="border-end">
            <div class="small mb-1 opacity-75">RECEITA MENSAL</div>
            <div class="fs-5 fw-bold text-primary">{{ faturamento?.faturamentoMes | currency:'BRL':'symbol':'1.2-2' }}
            </div>
          </c-col>
          <c-col md="3" class="border-end">
            <div class="small mb-1 opacity-75">RECEITA SEMANAL</div>
            <div class="fs-5 fw-bold text-info">{{ faturamento?.faturamentoSemana | currency:'BRL':'symbol':'1.2-2' }}
            </div>
          </c-col>
          <c-col md="3" class="border-end">
            <div class="small mb-1 opacity-75">RECEITA DIÁRIA</div>
            <div class="fs-5 fw-bold text-warning">{{ faturamento?.faturamentoDia | currency:'BRL':'symbol':'1.2-2' }}
            </div>
          </c-col>
          <c-col md="3">
            <div class="small mb-1 opacity-75">ACUMULADO ANUAL</div>
            <div class="fs-5 fw-bold text-success">{{ faturamento?.faturamentoAnual | currency:'BRL':'symbol':'1.2-2' }}
            </div>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<!-- Main Chart - Faturamento Anual -->
<c-card class="my-4 chart-card">
  <c-card-body>
    <c-row>
      <c-col sm="12">
        <h4 class="card-title mb-0 fw-semibold">Faturamento Anual</h4>
        <div class="small text-body-secondary">Mês a Mês</div>
      </c-col>
    </c-row>
    <div *ngIf="loadingDashboard" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
    </div>
    <c-chart *ngIf="!loadingDashboard" [data]="mainChart.data" [height]="300" [ngStyle]="{ 'marginTop.px': 40 }"
      [options]="mainChart.options" type="bar">
      Gráfico Barras Vertical, faturamento Anual, mês a mês
    </c-chart>
  </c-card-body>
</c-card>

<!-- Charts Row -->
<c-row class="mt-4">
  <c-col md="6">
    <c-card class="mb-4 chart-card">
      <c-card-header class="chart-card-header border-bottom">
        <h5 class="mb-0 fw-semibold">Indicadores</h5>
        <small class="text-muted">A Pagar vs A Receber</small>
      </c-card-header>
      <c-card-body>
        <div *ngIf="loadingDashboard" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>
        <c-chart *ngIf="!loadingDashboard" type="bar" [data]="indicadoresChart.data"
          [options]="indicadoresChart.options" style="height: 300px;">
          Gráfico Barras Horizontal, Indicantes 2 Barras (a Pagar, A receber)
        </c-chart>
      </c-card-body>
    </c-card>
  </c-col>
  <c-col md="6">
    <c-card class="mb-4 chart-card">
      <c-card-header class="chart-card-header border-bottom">
        <h5 class="mb-0 fw-semibold">Taxa de Cartão</h5>
        <small class="text-muted">Evolução mensal</small>
      </c-card-header>
      <c-card-body>
        <div *ngIf="loadingDashboard" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>
        <c-chart *ngIf="!loadingDashboard" type="bar" [data]="taxaCartaoChart.data" [options]="taxaCartaoChart.options"
          style="height: 300px;">
          Gráfico Barras, Taxa de cartão mês a mês
        </c-chart>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<!-- Traffic & Sales Section -->
<c-row class="mt-4">
  <c-col xs>
    <c-card class="mb-4 chart-card">
      <c-card-header class="chart-card-header border-bottom">
        <h5 class="mb-0 fw-semibold">Relação Pagamento/Recebimento Semanal Indicante</h5>
      </c-card-header>
      <c-card-body>
        <div *ngIf="loadingTrafficAndSales" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>
        <c-row *ngIf="!loadingTrafficAndSales">
          <c-col md="12" xl="12" xs="12">
            <c-row>
              <c-col xs="12">
                <div class="border-start border-start-4 border-start-info py-1 px-3 mb-3">
                  <div class="text-body-secondary text-truncate small">
                    Total Indicante a Receber
                  </div>
                  <div class="fs-5 fw-semibold">{{ trafficAndSales?.totalAReceber | currency:'BRL':'symbol':'1.2-2' }}
                  </div>
                </div>
              </c-col>
              <c-col xs="12">
                <div class="border-start border-start-4 border-start-danger py-1 px-3 mb-3">
                  <div class="text-body-secondary text-truncate small">
                    Total Indicante a Pagar
                  </div>
                  <div class="fs-5 fw-semibold">{{ trafficAndSales?.totalAPagar | currency:'BRL':'symbol':'1.2-2' }}
                  </div>
                </div>
              </c-col>
            </c-row>
            <hr class="mt-0" />
            <div class="progress-group mb-4" *ngFor="let day of trafficAndSales?.weeklyProgress">
              <div class="progress-group-prepend">
                <span class="text-body-secondary small">{{ day.dayOfWeek }}</span>
              </div>
              <div class="progress-group-bars">
                <c-progress thin color="info" [value]="day.areceberValue" aria-label="A Receber" />
                <c-progress thin color="danger" [value]="day.apagarValue" aria-label="A Pagar" />
              </div>
            </div>

            <div class="legend text-center d-none d-md-block" ngPreserveWhitespaces>
              <small>
                <sup>
                  <span class="badge badge-pill badge-sm bg-info">&nbsp;</span>
                </sup>
                <span>Total Indicante a Receber</span>
                &nbsp;&nbsp;
                <sup>
                  <span class="badge badge-pill badge-sm bg-danger">&nbsp;</span>
                </sup>
                <span>Total Indicante a Pagar</span>
              </small>
            </div>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>